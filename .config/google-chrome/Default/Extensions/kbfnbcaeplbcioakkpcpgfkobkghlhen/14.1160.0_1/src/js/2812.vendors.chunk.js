(self.webpackChunk=self.webpackChunk||[]).push([[2812],{12052:(e,t,n)=>{n.d(t,{E:()=>X,G:()=>ie});var r,o,i,u=n(64015),a=n(17889),s=n(57050),c=n(23239),d=n(19429),f=n(81670),l=n(92843),p=n(93756),v=n(5114),h=n(95195),m=n(71249),I=n(55415),y=n(83078),g=n(22232),b=n(8125),w=n(42040),S=n(46680),_=n(21038),A=n(12054),R=n(64681);function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(o=r||(r={})).iso=function(){return R.k4()},o.empty=function(){return{sduiQueue:new Map}},o.removeAllBySduiId=function(e){return function(t){return(0,s.zG)(r.toQueueValuesArray(t),m.hX((function(t){return 0===t.id.indexOf("".concat(e.event.sduiRootId,"_"))})),(function(e){return r.removeItems(e)(t),e}))}},o.removeEarlierItemsBySduiId=function(e){return function(t){return(0,s.zG)(r.toQueueValuesArray(t),m.hX((function(t){return 0===t.id.indexOf("".concat(e.event.sduiRootId,"_"))&&t.order<e.order})),(function(e){return r.removeItems(e)(t),e}))}},o.addItem=function(e){return function(t){t.sduiQueue.set(e.id,e)}},o.removeItems=function(e){return function(t){e.forEach((function(e){return t.sduiQueue.delete(e.id)}))}},o.toQueueValuesArray=function(e){return Array.from(e.sduiQueue.values())},function(e){var t,n,o,i=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};o=0,(n="QueueCounter")in(t=i)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o;e.show={show:function(e){return Array.from(r.iso().unwrap(e).sduiQueue.entries()).map((function(e){var t=E(e,2),n=t[0],r=t[1];return"".concat(n," - { id: ").concat(r.id," sduiRootId: ").concat(r.event.sduiRootId,", kind: ").concat(r.event.kind)})).join(";\n")}};!function(e){var t;!function(e){e.from=function(e){return"".concat(e)}}(t=e.Id||(e.Id={}));e.fromEvent=function(e){return{id:t.from("".concat(e.sduiRootId,"_").concat(++i.QueueCounter)),order:i.QueueCounter,event:e}}}(e.Item||(e.Item={}));e.empty=function(){return r.iso().wrap(r.empty())},e.removeAllBySduiId=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.removeAllBySduiId(e))}},e.addItem=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.addItem(e))}},e.removeItems=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.removeItems(e))}},e.removeEarlierItemsBySduiId=function(e){return function(t){return(0,s.zG)(r.iso().unwrap(t),r.removeEarlierItemsBySduiId(e))}},e.toQueueValuesArray=function(e){return(0,s.zG)(r.iso().unwrap(e),r.toQueueValuesArray)}}(i||(i={}));var U=n(28811),D=n(31539),P=n(32952),k=n(9922),j=n(24209),C=n(77843),G=n(93508),M=n(77176),z=n(2834),F=n(67434),T=n(60797),x=n(36919),V=n(85985),Q=n(41398),B=n(24055),K=n(26393),L=n(4477),q=n(98403);function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X,J=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),W(this,"_globalPartsState",c.h.create(new Map)),W(this,"_subs",new k.w.Keeper),W(this,"globalPartsAvailable",this._globalPartsState.view((function(e){return 0!==e.size}))),W(this,"getGlobalPartById",(function(e){return v.fromNullable(n._globalPartsState.get().get(_.j.Item.Id.from(e)))})),this._subs.push(t.pipe(M.U((function(e){return U.a.reduce(new Map,(function(e,t){return"globalPart"===t.content.type&&e.set(t.id,t.content),e}))(e)}))).subscribe(q.wW(this._globalPartsState)))}var t,n,r;return t=e,(n=[{key:"dispose",value:function(){this._subs.dispose()}}])&&N(t.prototype,n),r&&N(t,r),e}();function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Y(e,t,n[t])}))}return e}function te(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}!function(e){e.create=function(e,t){return{card:e,parentStrongAlertRef:t}},e.isAssistantCardContent=function(e){return"assistantCard"===e.card.type},e.isInlineCardContent=function(e){return"inlineCard"===e.card.type}}(X||(X={}));var re,oe,ie=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new L.J,o=this;$(this,e),Y(this,"alertIdResolver",void 0),Y(this,"popoverManager",void 0),Y(this,"_state",void 0),Y(this,"state",void 0),Y(this,"globalPartManager",void 0),Y(this,"_onAlertsRefEmpty",void 0),Y(this,"_removedAlerts",void 0),Y(this,"_removedRoot",void 0),Y(this,"_switchView",void 0),Y(this,"_sessionEvents",void 0),Y(this,"_reviseSduiQueue",void 0),Y(this,"_flush",void 0),Y(this,"_flushViewSwitch",void 0),Y(this,"_subs",void 0),Y(this,"_log",void 0),Y(this,"loadItems",void 0),Y(this,"_arrayToDiff",void 0),Y(this,"findFirstCardWithContent",void 0),Y(this,"notifyAlertsChanged",void 0),Y(this,"onSessionStarted",void 0),Y(this,"onFirstCheckingFinished",void 0),Y(this,"_processEvents",void 0),Y(this,"_getAllAlertsIdsFromEvent",void 0),Y(this,"_getAlertsIdsFromAlertRef",void 0),Y(this,"_getAlertsIdsFromDSL",void 0),Y(this,"_resolveAlertIds",void 0),Y(this,"_hasAllAlerts",void 0),Y(this,"_toInternalDiff",void 0),Y(this,"_preserveViewStackForCAPIUpdates",void 0),Y(this,"_normalizeSDUIEvents",void 0),Y(this,"_toSDUIItem",void 0),Y(this,"_emitDomainEvent",void 0),Y(this,"_debugLogState",void 0),Y(this,"_getBufferObs",void 0),this.alertIdResolver=n,this.popoverManager=r,this._state=c.h.create(D.l.empty),this.state=this._state.view((function(e){return D.l.iso.wrap(e)})),this.globalPartManager=new J(this.state),this._onAlertsRefEmpty=new P.xQ,this._removedAlerts=new P.xQ,this._removedRoot=new P.xQ,this._switchView=new P.xQ,this._sessionEvents=new P.xQ,this._reviseSduiQueue=new P.xQ,this._flush=new P.xQ,this._flushViewSwitch=new P.xQ,this._subs=new k.w.Keeper,this._log=w.C8.Logging.getLogger("SDUIManager",S.i.TRACE,S.T.Manager.getColor()),this.loadItems=function(e){var t=(0,s.zG)(e,u.uK((function(e){return"popoverStack"===e.content.type}))),n=t.right,r=t.left;n.forEach((function(e){var t=e.content;"popoverStack"===t.type&&o.popoverManager.addPopover(t)})),(0,s.zG)(r,u.UI((function(e){return te(ee({},e),{invalid:!0})})),o._arrayToDiff,D.l.applyDiff,d.UI(f.T.recover((function(e){return o._log.debug("conflicts on diff apply",e)}))),(function(e){return o._state.modify(e)}))},this._arrayToDiff=function(e){return l.v.fromMutation((function(t){return u.UI((function(e){t.set(e.id,p.F2(e))}))(e)}))},this.findFirstCardWithContent=function(e){return(0,s.zG)(o.state.get(),U.a.get(e),v.map((function(e){var t=e.content;return K.ab.reduce(t,(function(e,t){return(0,s.zG)(e,h.fold((function(e){return"strongAlertRef"===t.type?h.left(v.some(t)):"assistantCard"===t.type||"inlineCard"===t.type?h.right(X.create(t,e)):h.left(e)}),h.right))}),K.ab.TreeTraversal.PreOrder,h.left(v.none))})),v.chain(v.fromEither))},this.notifyAlertsChanged=function(){return o._reviseSduiQueue.next()},this.onSessionStarted=function(){return o._sessionEvents.next(oe.Start)},this.onFirstCheckingFinished=function(){return o._sessionEvents.next(oe.FirstCheckingFinished)},this._processEvents=function(e){return function(t,n){var r=(0,s.zG)(n,h.fold((function(n){return(0,s.zG)(i.toQueueValuesArray(t),m.hX(e))}),(function(n){if(n.kind===B.e.SduiEventKind.Remove){o._log.debug("[IN - ".concat(n.kind,", {id: ").concat(n.sduiRootId,"}] removeAllBySduiId"));var r=i.Item.fromEvent(n);return i.removeAllBySduiId(r)(t),[r]}var u=i.Item.fromEvent(n);return e(u)?(o._log.debug("[IN - ".concat(u.event.kind," {sduiRootId: ").concat(u.event.sduiRootId,", id: ").concat(u.id," refs: ").concat(JSON.stringify(K.ab.getAlertIds(u.event.sdui)),"}, ] hasAllAlerts")),[u]):(i.addItem(u)(t),o._log.debug("[IN - ".concat(u.event.kind," {sduiRootId: ").concat(u.event.sduiRootId,", id: ").concat(u.id," refs: ").concat(JSON.stringify(K.ab.getAlertIds(u.event.sdui)),"}] add to queue, [queue]: ").concat(i.show.show(t))),[])})),(function(e){return o._log.debug("[completeItems] ".concat(e.map((function(e){return e.id})).join(", "),", [queue]: ").concat(i.show.show(t))),i.removeItems(e)(t),e.forEach((function(e){return i.removeEarlierItemsBySduiId(e)(t)})),e}),m.UI(I.ei("event")));return te(ee({},t),{completeEvents:r})}},this._getAllAlertsIdsFromEvent=function(e,t){return(0,s.ls)((function(e){return e.sdui}),o._getAlertsIdsFromDSL(e,t))},this._getAlertsIdsFromAlertRef=function(e,t){return function(n){return(0,s.zG)(n,K.ab.getAlertIds,y.ew((function(){return t===re.Silent?{}:o._log.debug("Provided SDUI dsl doesn't contain alertIds array. StrongAlertRef: ".concat(JSON.stringify({id:n.id,type:n.type,name:n.name,alertIds:n.alertIds})))})),v.fold((function(){return[]}),s.yR),o._resolveAlertIds(e,t))}},this._getAlertsIdsFromDSL=function(e,t){return function(n){return(0,s.zG)(n,K.ab.getAllAlertIds,(function(e){return Array.from(new Set(e))}),(function(e){return u.xb(e)?(o._log.trace("Provided SDUI dsl doesn't contain any alertIds references. DSL id: ".concat(n.id)),e):e}),o._resolveAlertIds(e,t))}},this._resolveAlertIds=function(e,t){return function(n){return(0,s.zG)(n,u.UI((function(n){return(0,s.zG)(_.j.AlertId.from(n),e,y.ew((function(){return t===re.Silent?{}:o._log.error("Alert with raw id ".concat(n,", can not be found. It was either deleted or was not added yet."))})))})),u.vP(v.option))}},this._hasAllAlerts=function(e,t){return(0,s.ls)(o._getAllAlertsIdsFromEvent(e,t),v.isSome)},this._toInternalDiff=function(e){return function(t){var n=ne(t,2),r=n[0],i=n[1],u=D.l.MutableInternalDiff.empty();return(0,s.zG)(r,a.u4(u,(function(t,n){return n.kind===B.e.SduiEventKind.Remove?o._handleSDUIRemove(n,i,t):(0,s.zG)(o._getAllAlertsIdsFromEvent(e,re.Silent)(n),v.map(o._toSDUIItem(n)),v.fold((function(){return o._log.trace(ue.internalDiffParsingError([K.ab.getAllAlertIds(n.sdui).join(", "),n.sduiRootId]))}),(function(e){var r=n.kind;switch(r){case B.e.SduiEventKind.Add:o._handleSDUIAdd(e,n.rev,i,t);break;case B.e.SduiEventKind.Update:o._handleSDUIUpdate(e,i,t);break;default:(0,g.vE)(r)}})),(function(e){return t}))})))}},this._preserveViewStackForCAPIUpdates=function(e){return(0,s.zG)(e,a.UI((function(e){return e.kind!==B.e.SduiEventKind.Update||e.source!==A.i5.CAPI?e:A.R6.of(e.sduiRootId,e.source,e.rev)(v.fold((function(){return v.some(e.sdui)}),(0,s.ls)(K.ab.toContentMap,(function(t){return(0,s.zG)(t,Object.values,m.DZ((function(e){var t=e.content;return"viewStack"===t.type?v.some({type:"switchView",where:t.id,selected:t.selected}):v.none})),(function(n){return K.ab.bulkSwitchView(e.sdui,n,t)}))}),v.some)))})))},this._normalizeSDUIEvents=function(e){var t=ne(e,2),n=t[0],r=t[1];return(0,s.zG)(n,u.DZ((function(e){return"sdui_lazy_update"!==e.kind?v.some(e):o._handleSDUILazyUpdate(e,r)})))},this._toSDUIItem=function(e){return function(t){return{id:_.j.Item.Id.from(e.sduiRootId),content:e.sdui,alertIds:t}}},this._emitDomainEvent=function(e){o._log.debug("internalDiff",D.l.InternalDiff.show.show(e)),(0,s.zG)(e,D.l.createDiff,f.T.recover((function(e){return o._log.debug("conflicts on diff creating",e)})),(function(e){return o._log.debug("SDUIItemsCollectionDiff",D.l.diffShow.show(e)),e}),D.l.applyDiff,d.UI(f.T.recover((function(e){return o._log.debug("conflicts on diff apply",e)}))),(function(e){return o._state.modify(e)}))},this._debugLogState=function(e){return o._log.debug("[SDUIManagerState] (SDUIItemsCollection)","_latestChangeDiff: ".concat(D.l.diffShow.show(e.latestChangeDiff),",\n _entriesIds: ").concat(D.l.InternalDiff.showMapKeys.show(e.entries),"}"))},this._getBufferObs=function(){return{bufferObsForSDUIEvents:j.T(C.F(100).pipe(G.O(0)),o._flush),bufferObsForViewSwitchEvents:j.T(C.F(100).pipe(G.O(0)),o._flushViewSwitch)}},this._subs.push(this.globalPartManager);var R=t.pipe(M.U(A.al.fromSource(A.i5.CAPI))),O=this._getBufferObs(),E=O.bufferObsForSDUIEvents,q=O.bufferObsForViewSwitchEvents,N=(0,A.yU)(this._removedAlerts.asObservable(),this._removedRoot.asObservable(),this.state,this._switchView.asObservable(),this.popoverManager,this.globalPartManager,this._log,q),W=N.emptyAlertsRefReasonTuple,Z=N.optimisticRemoveSDUIEvent,H=N.emptyStrongAlertRefUpdate,ie=N.viewStackUpdates,ae=N.activePopoverUpdates,se=N.globalPartPlaceholderUpdates,ce=j.T(R,Z,H).pipe(z.b((function(e){return o._log.debug("Received SDUI event: ".concat(A.al.show.show(e)," from: ").concat(e.source))})),F.R((function(e,t){var n=t.source;switch(n){case A.i5.RemoveAlertsSDUIAction:case A.i5.RemoveRootSDUIAction:case A.i5.RemoveDuplicate:case A.i5.TextChange:return t.kind===B.e.SduiEventKind.Remove&&e.optRemovedSDUIRootIds.add(t.sduiRootId),te(ee({},e),{event:v.some(t)});case A.i5.CAPI:return(0,s.zG)(t,v.fromPredicate((function(t){return e.optRemovedSDUIRootIds.has(t.sduiRootId)})),y.bw((function(t){return e.optRemovedSDUIRootIds.delete(t.sduiRootId)})),v.chain(v.fromPredicate((0,b.Kg)(A.G0,A.eQ))),v.fold((function(){return te(ee({},e),{event:v.some(t)})}),(function(t){return t.kind===B.e.SduiEventKind.Remove?te(ee({},e),{event:v.none}):te(ee({},e),{event:v.some(te(ee({},t),{kind:B.e.SduiEventKind.Add}))})})));case A.i5.SwitchView:return te(ee({},e),{event:v.some(t)});default:(0,g.vE)(n)}}),{optRemovedSDUIRootIds:new Set,event:v.none}),M.U(I.ei("event")),T.oA,M.U(h.right)),de=(0,s.ls)(I.ei("event"),this._hasAllAlerts(this.alertIdResolver,re.Silent)),fe=j.T(ce,this._reviseSduiQueue.pipe(M.U(h.left))).pipe(F.R(this._processEvents(de),te(ee({},i.empty()),{completeEvents:[]})),M.U(I.ei("completeEvents"))),le=j.T(fe,ie,ae,se).pipe(x.f(E),M.U((function(e){return u.xH(e)})),V.h(u.Od)),pe=le.pipe(M.U(this._preserveViewStackForCAPIUpdates),Q.M(this._state),M.U(this._normalizeSDUIEvents),V.h(u.Od)),ve=this._sessionEvents.pipe(V.h((function(e){return e===oe.Start})),Q.M(this._state),M.U((function(e){var t=ne(e,2);t[0];return t[1]})),V.h((function(e){return e.entries.size>0})),M.U(D.l.MutableInternalDiff.fromState((function(e,t){var n=te(ee({},t),{invalid:!0});return _.j.Item.eq.equals(t,n)||e.updated.set(t.id,[t,n]),e})))),he=this._sessionEvents.pipe(V.h((function(e){return e===oe.FirstCheckingFinished})),Q.M(this._state),M.U((function(e){var t=ne(e,2);t[0];return t[1]})),V.h((function(e){return e.entries.size>0})),M.U(D.l.MutableInternalDiff.fromState((function(e,t){var n;return null!==(n=t.invalid)&&void 0!==n&&n&&e.removed.set(t.id,t),e})))),me=j.T(ve,he);this._subs.push(this._state.pipe(z.b(this._debugLogState)).subscribe(),W.subscribe((function(e){var t=ne(e,1)[0];return o._onAlertsRefEmpty.next(t)})),pe.pipe(Q.M(this._state),M.U(this._toInternalDiff(this.alertIdResolver)),V.h((0,s.ff)(D.l.InternalDiff.isEmpty)),M.U(this._emitDomainEvent)).subscribe(),me.subscribe(this._emitDomainEvent))}var t,n,r;return t=e,(n=[{key:"onAlertsRefEmpty",get:function(){return this._onAlertsRefEmpty.asObservable()}},{key:"pushRemovedRoot",value:function(e){this._removedRoot.next(e)}},{key:"pushRemovedAlerts",value:function(e){this._removedAlerts.next(e)}},{key:"pushSwitchView",value:function(e){this._switchView.next(e)}},{key:"flush",value:function(){this._flush.next(),this._flushViewSwitch.next(),this._flush.next()}},{key:"resolveStrongAlertRefAlerts",value:function(e){var t=this;return(0,s.zG)(this._getAlertsIdsFromAlertRef(this.alertIdResolver,re.Error)(e),y.ew((function(){return t._log.debug("Alert ids from the provided component were not removed, because AlertIds for the provided DSL was not resolved. SDUI content ".concat(JSON.stringify({id:e.id,type:e.type,name:e.name,alertIds:e.alertIds})))})))}},{key:"_handleSDUIAdd",value:function(e,t,n,r){var o=this;return"popoverStack"===e.content.type?(this.popoverManager.addPopover(e.content,t),D.l.MutableInternalDiff.empty()):((0,s.zG)(n,D.l.get(e.id),v.fold((function(){if((0,g.kG)(!r.updated.has(e.id),"SDUI item can not be in the diff.updated until it gets to the collection",(function(){return D.l.InternalDiff.show.show(r)+D.l.diffShow.show(D.l.diff(D.l.empty,n))})),r.removed.has(e.id))return o._log.trace(ue.actionOnRemovedItem([e.id,"added"]));r.added.set(e.id,e)}),(function(t){if((0,g.kG)(!r.added.has(e.id),"SDUI item can not be in the diff.added when it is already in the collection",(function(){return D.l.InternalDiff.show.show(r)+D.l.diffShow.show(D.l.diff(D.l.empty,n))})),r.removed.has(e.id))return o._log.trace(ue.actionOnRemovedItem([e.id,"added"]));r.updated.set(e.id,[t,e])}))),r)}},{key:"_handleSDUIUpdate",value:function(e,t,n){var r=this;return(0,s.zG)(t,D.l.get(e.id),v.fold((function(){return(0,g.kG)(!n.updated.has(e.id),"SDUI item can not be in the diff.updated until it gets to the collection"+D.l.InternalDiff.show.show(n)+D.l.diffShow.show(D.l.diff(D.l.empty,t))),n.removed.has(e.id)?r._log.trace(ue.actionOnRemovedItem([e.id,"updated"])):n.added.has(e.id)?(r._log.trace(ue.updateIdMissingFound([e.id])),void n.added.set(e.id,e)):r._log.error(ue.updateIdMissingNotFound([e.id]))}),(function(o){return(0,g.kG)(!n.added.has(e.id),"SDUI item can not be in the diff.added when it is already in the collection"+D.l.InternalDiff.show.show(n)+D.l.diffShow.show(D.l.diff(D.l.empty,t))),n.removed.has(e.id)?r._log.trace(ue.actionOnRemovedItem([e.id,"update"])):_.j.Item.eq.equals(o,e)?r._log.trace(ue.updateItemsAreEqual([e.id])):void n.updated.set(e.id,[o,e])}))),n}},{key:"_handleSDUIRemove",value:function(e,t,n){var r=this,o=_.j.Item.Id.from(e.sduiRootId);return this.popoverManager.removePopover(o,e.rev),(0,s.zG)(t,D.l.get(o),v.fold((function(){if((0,g.kG)(!n.updated.has(o),"SDUI item can not be in the diff.updated until it gets to the collection"+D.l.InternalDiff.show.show(n)+D.l.diffShow.show(D.l.diff(D.l.empty,t))),!n.added.has(o))return r._log.trace(ue.removeIdMissingNotFound([o]));r._log.trace(ue.removeIdMissingFound([o])),n.added.delete(o)}),(function(e){(0,g.kG)(!n.added.has(e.id),"SDUI item can not be in the diff.added when it is already in the collection"+D.l.InternalDiff.show.show(n)+D.l.diffShow.show(D.l.diff(D.l.empty,t))),n.updated.delete(o)?r._log.trace(ue.idRemovedFrom([o,"diff.updated"])):(0,s.Q1)(),n.removed.set(o,e)}))),n}},{key:"_handleSDUILazyUpdate",value:function(e,t){var n=this;return(0,s.zG)(t,D.l.get(e.sduiRootId),y.ew((function(){return n._log.trace("SDUI Item with sduiRootId ".concat(e.sduiRootId,"  was not found"))})),v.fold((function(){return e.toContent(v.none)}),(function(t){var r=t.content;return(0,s.zG)(e.toContent(v.some(r)),v.filter((function(e){return!K.ab.eq.equals(e,r)})),y.ew((function(){return n._log.trace("SDUI Update event ".concat(JSON.stringify(e)," will be skipped, because the new DSL is the same as an old one"))})))})),v.map((function(t){return{kind:B.e.SduiEventKind.Update,sdui:t,sduiRootId:B.e.RawSduiItem.Id.create(e.sduiRootId),rev:e.rev,source:e.source}})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&H(t.prototype,n),r&&H(t,r),e}(),ue={removeIdMissingFound:function(e){var t=ne(e,1)[0];return"[Remove] SDUI item with ID ".concat(t," was found in the added messages. Removing it.")},removeIdMissingNotFound:function(e){var t=ne(e,1)[0];return"[Remove] It is not possible to remove SDUI item with ID ".concat(t,". It is missing from SDUIItemsCollectionInternal and diff.add, probably it was deleted earlier. Skipping the message")},idRemovedFrom:function(e){var t=ne(e,2),n=t[0],r=t[1];return"[Remove] SDUI item with ID ".concat(n," is going to be removed. ").concat(r," contains the item with ID ").concat(n," too. Remove ").concat(n," from ").concat(r)},actionOnRemovedItem:function(e){var t=ne(e,2),n=t[0],r=t[1];return"[".concat(r,"] It is not possible to ").concat(r," SDUI item with ID ").concat(n,". Because it was already removed. Skipping the ").concat(r,".")},viewStackUpdateIdMissing:function(e){var t=ne(e,1)[0];return"[ViewStackUpdate] SDUI item with ID ".concat(t," was found. Skipping the update.")},updateIdMissingFound:function(e){var t=ne(e,1)[0];return"[Update] SDUI item with ID ".concat(t," was found in added messages. Updating it in added messages")},updateIdMissingNotFound:function(e){var t=ne(e,1)[0];return"[Update] It is not possible to update SDUI item with ID ".concat(t,". It is missing from SDUIItemsCollectionInternal and diff.added, probably it was deleted earlier. Skipping the message")},updateItemsAreEqual:function(e){var t=ne(e,1)[0];return"[Update] Received sdui item (sduiId: ".concat(t,") is the same as in the state. Skipping the update message")},internalDiffMissingAlertsIds:function(){return"missing AlertIDs"},internalDiffParsingError:function(e){var t=ne(e,2),n=t[0],r=t[1];return"toInternalDiff, either can not resolve ".concat(n," for ").concat(r," or id of the sdui item is missing . The item will be skipped")}};!function(e){e.Silent="Silent",e.Error="Error"}(re||(re={})),function(e){e.Start="Start",e.FirstCheckingFinished="FirstCheckingFinished"}(oe||(oe={}))},12054:(e,t,n)=>{n.d(t,{al:()=>L,R6:()=>N,i5:()=>q,yU:()=>B,eQ:()=>X,G0:()=>W});var r,o,i,u,a,s,c=n(17889),d=n(64015),f=n(32243),l=n(57050),p=n(71249),v=n(5114),h=n(41398),m=n(2834),I=n(77176),y=n(66310),g=n(12126),b=n(38194),w=n(85985),S=n(24209),_=n(36919),A=n(2844),R=n(24055),O=n(26393),E=n(21038),U=n(28811),D=n(64681),P=n(83078),k=n(40330);function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function M(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}u=r||(r={}),(i=u.EmptyMessage||(u.EmptyMessage={})).fromItem=function(e){return e.alertIds,M(e,["alertIds"])},i.show={show:function(e){var t=e.sduiId,n=e.sduiRootId;return JSON.stringify({sduiId:t,sduiRootId:n})}},(u.EmptyItem||(u.EmptyItem={})).isRootItem=function(e){return e.sduiId===e.sduiRootId},function(e){e.fromSDUI=function(e){return function(r){return O.ab.reduce(r.content,(function(o,i){return(0,l.zG)(o,v.chain((function(t){return(0,l.zG)(i,O.ab.getAlertIds,v.chain(e),v.map(n(t)),v.alt((function(){return o})))})),v.alt((function(){return(0,l.zG)(i,O.ab.getAlertRefs,v.chain(t(r.id,e)))})))}),O.ab.TreeTraversal.PreOrder,v.none)}};var t=function(e,t){return function(r){return r.reduce((function(r,o){return(0,l.zG)(r,v.map((function(e){return(0,l.zG)(o.alertIds,t,v.fold((function(){return e}),n(e)))})),v.alt((function(){return v.some({emptyStrongAlertRef:o,sduiId:e,sduiRootId:e,alertIds:new Set((0,l.zG)(o.alertIds,t,v.getOrElse((0,l.a9)(p.cS))))})})))}),v.none)}},n=(e.fromStrongAlertRef=function(e){return function(t,n){return(0,l.zG)(e(t.alertIds),v.map((function(e){return{sduiRootId:n,sduiId:E.j.Item.Id.from(t.id),emptyStrongAlertRef:t,alertIds:new Set(e)}})))}},e.fromStrongAlertRefBehavior=function(e){return function(t,n,r){return(0,l.zG)(e(t.alertIds),v.map((function(e){return{sduiRootId:r,sduiId:n,emptyStrongAlertRef:t,alertIds:new Set(e)}})))}},e.show={show:function(e){return"StrAlertRef.Item: { sduiId: ".concat(e.sduiId,", sduiRootId: ").concat(e.sduiRootId,", alertIds: [").concat(Array.from(e.alertIds.values()).join(", "),"]}")}},e.addAlertIds=function(e){return function(t){return t.forEach((function(t){return e.alertIds.add(t)})),e}})}(a=u.Item||(u.Item={})),function(e){e.iso=D.k4(),e.empty=function(){return{alertRefMapping:new Map}},e.size=function(e){return e.alertRefMapping.size},e.show={show:function(e){return Array.from(e.alertRefMapping.entries()).map((function(e){var t=z(e,2),n=t[0],r=t[1];return"".concat(n,": [\n").concat(r.map(a.show.show).join("\n"),"\n]")})).join("\n")}};var t=function(e){return function(t){return(0,l.zG)(t.alertRefMapping.get(e),v.fromNullable)}},n=(e.get=function(e){return function(n){return(0,l.zG)(t(e)(n),v.map(p.UI((function(e){return G(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}({},e),{alertIds:new Set(e.alertIds)})}))))}},e.updateWithRemovedAlerts=function(e){return function(n){return(0,l.zG)(e,d.tS((function(e){return(0,l.zG)(n,t(e),v.map(p.hX((function(t){return t.alertIds.delete(e)&&0===t.alertIds.size}))),v.fold((function(){return[]}),(function(t){return n.alertRefMapping.delete(e),t.map(r.EmptyMessage.fromItem)})))})))}},e.add=function(e,t){return function(r){k.uZ.isStrongAlertRefBehavior(e.emptyStrongAlertRef)?(0,l.zG)(a.fromStrongAlertRefBehavior(t)(e.emptyStrongAlertRef,e.sduiId,e.sduiRootId),P.bw(n(r))):O.ab.forEach(e.emptyStrongAlertRef,(0,l.ls)(function(e,t){return function(n){return(0,l.zG)(n,O.ab.getAlertRefs,v.fold((0,l.a9)(d.cS),d.DZ((function(r){return k.uZ.isStrongAlertRefBehavior(r)?a.fromStrongAlertRefBehavior(t)(r,E.j.Item.Id.from(n.id),e):a.fromStrongAlertRef(t)(r,e)}))))}}(e.sduiRootId,t),p.UI(n(r))),O.ab.TreeTraversal.PostOrder)}},function(e){var t=o(e);return function(e){e.alertIds.forEach((function(n){return t(n,[e])}))}}),o=function(e){return function(t,n){var r=e.alertRefMapping.get(t);e.alertRefMapping.set(t,null!=r?r.concat(n):n)}};e.remove=function(e){return function(n){return(0,l.zG)(Array.from(e.alertIds.keys()),p.u4(new Array,(function(r,i){return(0,l.zG)(n,t(i),v.map(p.hX((function(t){return t.sduiRootId!==e.sduiRootId}))),v.fold((function(){r.push("failed to remove SDUI by alertId ".concat(i,", alertRefMapping doesn't contain alertId ").concat(i))}),(function(e){return function(e){return function(t,n){0===n.length?e.alertRefMapping.delete(t):o(e)(t,n)}}(n)(i,e)}))),r})))}}}(s||(s={})),(o=u.Collection||(u.Collection={})).empty=function(){return s.iso.wrap(s.empty())},o.size=function(e){return(0,l.zG)(s.iso.unwrap(e),s.size)},o.show={show:function(e){return(0,l.zG)(s.iso.unwrap(e),s.show.show)}},o.get=function(e){return function(t){return(0,l.zG)(s.iso.unwrap(t),s.get(e))}},o.add=function(e,t){return function(n){return(0,l.zG)(s.iso.unwrap(n),s.add(e,t))}},o.remove=function(e){return function(t){return(0,l.zG)(s.iso.unwrap(e),s.remove(t))}},o.updateWithRemovedAlerts=function(e){return function(t){return(0,l.zG)(s.iso.unwrap(t),s.updateWithRemovedAlerts(e))}};var Q=(0,l.ls)(p.UI(E.j.AlertId.from),v.some),B=function(e,t,n,o,i,u,a,s){var D=e.pipe(h.M(n),m.b((function(e){var t=V(e,1),n=V(t[0],2),r=n[0],o=n[1];a.trace("[Optimistic update] emptyAlertsRefReasonTuple > Removed alerts. Reason: ".concat(o,", removedAlertIds: [").concat(r.join(", "),"]"))})),I.U((function(e){var t=V(e,2),n=V(t[0],2),o=n[0],i=n[1],u=t[1];return[(0,l.zG)(u,K(a),r.Collection.updateWithRemovedAlerts(o)),i]})),m.b((function(e){var t=V(e,2),n=t[0],o=t[1];return a.trace("[Optimistic update] emptyAlertsRefReasonTuple > Reason: ".concat(o," found emptyAlertsRef: [").concat(n.map(r.EmptyMessage.show.show).join(", "),"]"))})),y.w((function(e){var t=V(e,2),n=t[0],r=t[1];return(0,l.zG)(n,d.UI((function(e){return[e,r]})),(function(e){return g.D(e)}))})),b.B()),P=D.pipe(w.h((function(e){var t=V(e,1)[0];return r.EmptyItem.isRootItem(t)})),I.U((function(e){var t=V(e,2),n=t[0],r=t[1];return L.toRemovedEvent(r)(R.e.RawSduiItem.Id.create(n.sduiRootId))}))),k=t.pipe(I.U((function(e){var t=V(e,2),n=t[0],r=t[1];return L.toRemovedEvent(r)(R.e.RawSduiItem.Id.create(n))}))),j=S.T(P,k),C=D.pipe(w.h((function(e){var t=V(e,1)[0];return!r.EmptyItem.isRootItem(t)})),h.M(n),I.U((function(e){var t=V(e,2),n=V(t[0],2),r=n[0],o=n[1],i=t[1],u=R.e.RawSduiItem.Id.create(r.sduiRootId);return(0,l.zG)(U.a.get(E.j.Item.Id.from(r.sduiRootId))(i),v.chain((function(e){return O.ab.removeStrongAlertRef(e.content)([r.emptyStrongAlertRef])})),v.fold((function(){return L.toRemovedEvent(o)(R.e.RawSduiItem.Id.create(r.sduiRootId))}),(function(e){return L.toUpdatedEvent(o)(e,u)})))})));return{emptyAlertsRefReasonTuple:D,optimisticRemoveSDUIEvent:j,emptyStrongAlertRefUpdate:C,viewStackUpdates:o.pipe(_.f(s),w.h(p.Od),I.U((0,l.ls)(c.vM((function(e){return e.sduiRootId})),f.AO,d.UI((function(e){var t=V(e,2),n=t[0],r=t[1];return r.forEach((function(e){return i.switchView(e)})),N.of(n,"switchView")(v.chain((function(e){return(0,l.zG)(O.ab.bulkSwitchView(e,r.map((function(e){return{where:e.where,selected:e.selected,type:"switchView"}}))),v.some)})))}))))),activePopoverUpdates:A.aj([i.activePopoverView,n.pipe(I.U(U.a.sduiRoots()))]).pipe(I.U((function(e){var t=V(e,2),n=t[0];return t[1].map((function(e){return N.of(e,"switchView")(v.chain((function(e){return O.ab.setPopoverView(e,n)})))}))}))),globalPartPlaceholderUpdates:u.globalPartsAvailable.pipe(w.h(l.yR),y.w((function(){return n})),I.U(U.a.sduiRoots()),I.U((function(e){return e.map((function(e){return N.of(e,"capi")(v.chain((function(e){return O.ab.setGlobalPartPlaceholderContent(e,u.getGlobalPartById)})))}))})))}};function K(e){return U.a.reduce(r.Collection.empty(),(function(t,n){return(0,l.zG)(r.Item.fromSDUI(Q)(n),v.fold((function(){return e.trace("SDUI item ".concat(E.j.Item.show.show(n)," does not contain AlertRef, skipping it"))}),(function(e){return r.Collection.add(e,Q)(t)})),(function(e){return t}))}))}var L,q,N,W=function(e){return e.kind==R.e.SduiEventKind.Update},X=function(e){return e.kind==R.e.SduiEventKind.Remove};!function(e){e.fromSource=function(e){return function(t){return x(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){T(e,t,n[t])}))}return e}({},t),{source:e})}},e.toRemovedEvent=function(e){return function(t){return{kind:R.e.SduiEventKind.Remove,sduiRootId:t,source:e,rev:0}}},e.toUpdatedEvent=function(e){return function(t,n){return{kind:R.e.SduiEventKind.Update,sdui:t,sduiRootId:n,source:e,rev:0}}},e.show={show:function(e){return"SduiRootId: ".concat(e.sduiRootId,", Kind: ").concat(e.kind,", Source: ").concat(e.source)}}}(L||(L={})),function(e){e.CAPI="capi",e.TextChange="textChange",e.RemoveAlertsSDUIAction="removeAlerts",e.RemoveRootSDUIAction="removeRoot",e.RemoveDuplicate="removeDuplicate",e.SwitchView="switchView"}(q||(q={})),function(e){e.of=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(r){return{kind:"sdui_lazy_update",toContent:r,sduiRootId:E.j.Item.Id.from(e),rev:n,source:t}}}}(N||(N={}))},4477:(e,t,n)=>{n.d(t,{J:()=>f});var r=n(23239),o=n(5114),i=n(22232),u=n(79880),a=n(57050),s=n(26393);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"activePopoverStack",void 0),d(this,"activePopoverView",void 0),d(this,"_state",void 0),this._state=r.h.create({dsl:o.none,revision:-1}),this.activePopoverStack=this._state.view("dsl"),this.activePopoverView=this.activePopoverStack.view(o.chain((function(e){return o.fromNullable(e.views[e.selected])})))}var t,n,f;return t=e,(n=[{key:"getInteractionActions",value:function(e,t,n){return(0,a.zG)(this._state.get(),(function(e){return e.dsl}),o.filter((function(n){return n.id===e&&n.selected===t})),o.map((function(e){return e.views[e.selected]})),o.fold((function(){return[]}),(function(e){switch(n){case u.fP.Fulfill:return e.onFulfill||[];case u.fP.Dismiss:return e.onDismiss||[];default:(0,i.L0)(n)}})))}},{key:"addPopover",value:function(e,t){this._state.modify((function(n){var r=void 0!==t&&n.revision>t,i=void 0!==t&&n.revision===t,u=(0,a.zG)(n.dsl,o.exists((function(t){return t.id===e.id}))),s=!o.isNone(n.dsl);return r||u||i&&s?n:{dsl:o.some(e),revision:null!=t?t:n.revision}}))}},{key:"removePopover",value:function(e,t){this._state.modify((function(n){var r=void 0!==t&&n.revision>t,i=(0,a.zG)(n.dsl,o.exists((function(t){return t.id===e})));return r||!i?n:{dsl:o.none,revision:null!=t?t:n.revision}}))}},{key:"switchView",value:function(e){this._state.modify((function(t){return(0,a.zG)(t.dsl,o.filter((function(t){return t.id===e.sduiRootId})),o.map((function(t){return s.ab.bulkSwitchView(t,[{where:e.where,selected:e.selected,type:"switchView"}])})),o.filter((function(e){return"popoverStack"===e.type})),o.fold((function(){return t}),(function(e){return{dsl:o.some(e),revision:t.revision}})))}))}}])&&c(t.prototype,n),f&&c(t,f),e}()},24055:(e,t,n)=>{var r;n.d(t,{e:()=>r}),function(e){var t;!function(e){!function(e){e.create=function(e){return e.toString()}}(e.Id||(e.Id={}))}(e.RawSduiItem||(e.RawSduiItem={})),function(e){e.Add="sdui_add",e.Remove="sdui_remove",e.Update="sdui_update"}(t=e.SduiEventKind||(e.SduiEventKind={})),e.isSduiEvent=function(e){return e.kind===t.Add||e.kind===t.Remove||e.kind===t.Update}}(r||(r={}))},14454:(e,t,n)=>{n.d(t,{t:()=>a});var r=n(57050),o=n(40154);n(83257);function i(e,t){return{decode:e.decode,encode:t.encode}}function u(e){return{decode:e.decode,encode:r.yR}}o.Z_,o.Rx,o.O7,o.dX,o.mI;var a,s,c,d,f,l,p=n(85384),v=n(73915),h=n(73975),m=n(95195),I=n(22232),y=n(66268),g=n(98992);s=a||(a={}),c=s.Type=y.lY.Type.sduiCardAction,d=v.n(p.z2)(g.eX),s.eq=h.f7((function(e,t){return e.type===c&&e.type===t.type&&e.cardId===t.cardId&&d.equals(e.actions,t.actions)&&e.scope===t.scope})),f=i(v.n(o.z2)(g.eX),{encode:function(e){return e}}),l=(0,r.ls)(f.decode,m.mapLeft((function(e){return new Error(o.ii(e))}))),s.isSduiCardAction=function(e){return e.type===a.Type&&(n=e.actions,m.isRight(l(n)))&&"object"==typeof(t=e.scope)&&null!=t&&Object.keys(t).every((function(e){var n=t[e];return"alertRefs"===e?Array.isArray(n):((0,I.L0)(e),!1)}));var t,n}},72812:(e,t,n)=>{n.d(t,{X:()=>T,x:()=>F});var r=n(57050),o=n(5114),i=n(22232),u=n(71249),a=n(83078),s=n(95195),c=n(64015),d=n(42040),f=n(46680),l=n(33678),p=n(14454),v=n(9922),h=n(32952),m=n(41398),I=n(85985),y=n(77176),g=n(16118),b=n(60797),w=n(2834),S=n(19751),_=n(50628),A=n(28811),R=n(12052),O=n(21038),E=n(12054),U=n(31668),D=n(26393);function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}function M(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var F=function(){function e(t,n,r,o,i){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new l.A;k(this,e),C(this,"_sduiService",void 0),C(this,"_sduiManager",void 0),C(this,"_sduiFeedManager",void 0),C(this,"_capiClient",void 0),C(this,"_focusedItem",void 0),C(this,"_platformEnvironment",void 0),C(this,"_log",void 0),C(this,"_subs",void 0),C(this,"_sduiAlertIdResolver",void 0),C(this,"sduiActionEvents",void 0),this._sduiService=t,this._sduiManager=n,this._sduiFeedManager=r,this._capiClient=o,this._focusedItem=i,this._platformEnvironment=u,this._log=d.C8.Logging.getLogger("SduiViewModelImpl",f.i.DEBUG),this._subs=new v.w.Keeper,this.sduiActionEvents=new h.xQ,this._sduiAlertIdResolver=T(this._sduiManager.alertIdResolver,this._log),this._subs.push(this._handleSduiActions(),this._handleSduiCardOnFocus(),this._handleSduiCardOnBlur(),this._handleSduiFeedRemove(),this._handleSduiFeedEmpty(),this._handleSduiOnEmptyEvents())}var t,n,c;return t=e,(n=[{key:"onAssistantClose",value:function(){var e=this;(0,r.zG)(this._sduiFeedManager.currentFeed,o.map((function(e){return e.feedId})),o.chain((function(t){return A.a.get(t)(e._sduiManager.state.get())})),o.chain((function(e){return(0,r.zG)(D.ab.findFirst(e.content,"assistantFeed"),o.filter((function(e){return Array.isArray(e.onAssistantClose)&&e.onAssistantClose.length>0})),o.map((function(t){return[t,e]})))})),o.map((function(t){var n=z(t,2),r=n[0],o=n[1];return e.sduiActionEvents.next({type:p.t.Type,sourceId:r.id,cardId:o.id,actions:r.onAssistantClose,scope:{alertRefs:o.alertIds}})})))}},{key:"_handleSduiOnEmptyEvents",value:function(){var e=this;return this._sduiManager.onAlertsRefEmpty.pipe(m.M(this._focusedItem),I.h((function(e){var t=z(e,2),n=t[0].sduiRootId,i=t[1];return(0,r.zG)(i,o.filter((function(e){return e===n})),o.isSome)})),y.U((function(e){return z(e,1)[0]}))).subscribe((function(t){var n=t.sduiId,r=t.sduiRootId,o=t.emptyStrongAlertRef;return e.sduiActionEvents.next({type:p.t.Type,sourceId:n,cardId:r,actions:o.onEmpty,scope:{alertRefs:o.alertIds}})}))}},{key:"_handleSduiFeedRemove",value:function(){var e=this;return this._sduiFeedManager.onFeedRemove.subscribe((function(t){(0,i.kG)("assistantFeed"===t.content.type),e.sduiActionEvents.next({type:p.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onRemove,scope:{alertRefs:[]}})}))}},{key:"_handleSduiFeedEmpty",value:function(){var e=this;return this._sduiFeedManager.onFeedEmpty.subscribe((function(t){(0,i.kG)("assistantFeed"===t.content.type),t.content.onEmpty&&e.sduiActionEvents.next({type:p.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onEmpty,scope:{alertRefs:[]}})}))}},{key:"_handleSduiCardOnBlur",value:function(){var e=this;return this._focusedItem.pipe(g.G(),y.U((function(t){var n=z(t,1)[0];return(0,r.zG)(n,o.chain((function(t){return(0,r.zG)(e._sduiManager.findFirstCardWithContent(t),o.filter(R.E.isAssistantCardContent),o.map((function(e){return[e,t]})))})))})),b.oA,w.b((function(t){var n=z(t,2),i=n[0],a=i.card,s=i.parentStrongAlertRef,c=n[1];e.sduiActionEvents.next({type:p.t.Type,sourceId:a.id,cardId:c,actions:a.onBlur,scope:{alertRefs:(0,r.zG)(s,o.map((function(e){return e.alertIds})),o.getOrElse((0,r.a9)(u.cS)))}})}))).subscribe()}},{key:"_handleSduiCardOnFocus",value:function(){var e=this;return this._focusedItem.pipe(b.oA,y.U((function(t){return(0,r.zG)(e._sduiManager.findFirstCardWithContent(t),o.map((function(e){return[e,t]})))})),b.oA).subscribe((function(t){var n=z(t,2),i=n[0],u=i.card,a=i.parentStrongAlertRef,s=n[1];e._sduiFeedManager.notifyCardFocused(s),e.sduiActionEvents.next({type:p.t.Type,sourceId:u.id,cardId:s,actions:u.onFocus,scope:{alertRefs:(0,r.zG)(a,o.map((function(e){return e.alertIds})),o.getOrElse((function(){return[]})))}})}))}},{key:"_handleSduiActions",value:function(){var e=this;return this.sduiActionEvents.pipe(S.skipBy(p.t.eq),w.b((function(t){var n=t.cardId,u=t.sourceId,c=t.actions,d=t.scope;e._log.info("sdui card action:",{cardId:n,actions:c,scope:d}),c.forEach((function(t){switch(t.type){case"notify":return void e._sduiService.sendUserAction(t.sourceId||u,t.userAction);case"removeRoot":return void requestAnimationFrame((function(){e._sduiManager.pushRemovedRoot([O.j.Item.Id.from(n),E.i5.RemoveRootSDUIAction])}));case"applyAlerts":case"closeCard":case"highlightAlert":case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"upgradeToPremium":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"showHighlights":case"hideHighlights":case"stopApplyingAlerts":case"selectAlternative":case"copyToClipboard":case"newRevision":case"openGrammarlyGo":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":return;case"removeAlerts":return void(0,r.zG)(e._sduiAlertIdResolver(d.alertRefs),a.bw((function(){requestAnimationFrame((function(){e._sduiManager.pushRemovedAlerts([d.alertRefs.map(O.j.AlertId.from),E.i5.RemoveAlertsSDUIAction])}))})));case"openLink":return void e._platformEnvironment.actions.openPopup(new U.Z(t.url));case"pushAssistantFeed":return void requestAnimationFrame((function(){return(0,r.zG)(e._sduiFeedManager.pushFeed(O.j.Item.Id.from(t.feedId),t.cardId),s.mapLeft((function(t){return e._log.error(t),t})))}));case"popAssistantFeed":return void requestAnimationFrame((function(){return e._sduiFeedManager.popFeed(o.fromNullable(t.fallbackFeed))}));case"focusAssistantCard":return void requestAnimationFrame((function(){return e._sduiFeedManager.focusCard(t.cardId)}));case"switchView":var c={where:t.where,selected:t.selected,sduiRootId:O.j.Item.Id.from(n)};return e._switchCallerCard(c),e._switchActiveCard(c),e._switchActiveFeed(c),void e._switchActivePopover(c);case"interactPopover":var f=e._sduiManager.popoverManager.getInteractionActions(t.rootPopoverId,t.popoverViewId,t.interaction);return void(f.length>0&&e.sduiActionEvents.next({type:p.t.Type,sourceId:t.rootPopoverId,cardId:t.popoverViewId,actions:f,scope:d}));case"closePopover":return e._sduiManager.popoverManager.removePopover(t.rootPopoverId),void e.sduiActionEvents.next({type:p.t.Type,sourceId:t.rootPopoverId,cardId:t.rootPopoverId,actions:[{type:"removeRoot"}],scope:d});case"enablePlagiarismCheck":return void e._capiClient.enablePlagiarismSearch();case"disablePlagiarismCheck":return void e._capiClient.disablePlagiarismSearch();case"enableWritingExpertCheck":return void e._capiClient.enableWritingExpert();case"disableWritingExpertCheck":return void e._capiClient.disableWritingExpert();default:(0,i.L0)(t)}}))}))).subscribe()}},{key:"_switchCallerCard",value:function(e){this._sduiManager.pushSwitchView(e)}},{key:"_switchActiveCard",value:function(e){var t=this;(0,r.zG)(this._focusedItem.get(),o.filter((function(t){return e.sduiRootId!==t})),a.bw((function(n){return t._sduiManager.pushSwitchView(M(G({},e),{sduiRootId:O.j.Item.Id.from(n)}))})))}},{key:"_switchActiveFeed",value:function(e){var t=this;(0,r.zG)(this._sduiFeedManager.currentFeed,o.filter((function(t){return t.feedId!==e.sduiRootId})),a.bw((function(n){var r=n.feedId;return t._sduiManager.pushSwitchView(M(G({},e),{sduiRootId:r}))})))}},{key:"_switchActivePopover",value:function(e){var t=this;this._sduiManager.popoverManager.activePopoverView.pipe(_.P()).subscribe(a.bw((function(n){var r=n.rootPopoverId;t._sduiManager.pushSwitchView(M(G({},e),{sduiRootId:r}))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&j(t.prototype,n),c&&j(t,c),e}();function T(e,t){return function(n){return(0,r.zG)(n,c.UI(e),c.vP(o.option),a.ew((function(){return t.error("Could not resolve strong alert ref for ".concat(JSON.stringify(n)))})),o.filter(c.Od),a.ew((function(){return t.error("Strong alert refs are empty")})))}}},83257:(e,t,n)=>{n.d(t,{AG:()=>i,IM:()=>c,IX:()=>d,OT:()=>h,Sm:()=>p,Vo:()=>v,bc:()=>f,dt:()=>a,id:()=>I,n_:()=>u,ov:()=>y,qm:()=>g,r$:()=>s,wf:()=>l});var r=n(18164),o=n(57050);function i(e){return{encode:function(t){return null===t?null:e.encode(t)}}}function u(e){return{encode:function(t){var n={};for(var r in e)n[r]=e[r].encode(t[r]);return n}}}var a=u;function s(e){return{encode:function(t){var n={};for(var r in e){var o=t[r];r in t&&(n[r]=void 0===o?void 0:e[r].encode(o))}return n}}}function c(e){return{encode:function(t){var n={};for(var r in t)n[r]=e.encode(t[r]);return n}}}function d(e){return{encode:function(t){return t.map(e.encode)}}}function f(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{encode:function(t){return e.map((function(e,n){return e.encode(t[n])}))}}}var l=function(e){return function(t){return{encode:function(n){return(0,r.U)(t.encode(n),e.encode(n))}}}};function p(e){return function(t){return{encode:function(n){return t[n[e]].encode(n)}}}}function v(e){var t=(0,r.H)(e);return{encode:function(e){return t().encode(e)}}}var h=o.yR,m=function(e,t){return{encode:function(n){return e.encode(t(n))}}};function I(){return{encode:o.yR}}var y="io-ts/Encoder",g={URI:y,contramap:m}}}]);